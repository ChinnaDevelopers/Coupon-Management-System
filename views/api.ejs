<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #333;
        color: #fff;
      }
      h1 {
        text-align: center;
        color: #fff;
        margin-top: 50px;
      }
      p {
        text-align: center;
        margin-top: 20px;
      }
      a {
        text-decoration: none;
        color: #fff;
        background-color: #555;
        padding: 5px 10px;
        border-radius: 5px;
        margin: 0 10px;
      }
      .dashboard {
        position: absolute;
        top: 0;
        left: 0;
        padding: 10px;
      }
      .user-details {
        position: absolute;
        top: 0;
        left: 0;
        padding: 10px;
      }
      .logout {
        color: red;
        background-color: #555;
        position: absolute;
        top: 0;
        right: 0;
        padding: 10px;
      }
      .api {
        position: absolute;
        top: 0;
        right: 43.5%;
        padding: 10px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        color: #fff;
      }
      th {
        background-color: #555;
        padding: 10px;
      }
      td {
        padding: 10px;
        text-align: center;
      }
      tr:nth-child(even) {
        background-color: #555;
      }
      tr:nth-child(odd) {
        background-color: #444;
      }
      .hidden {
        display: none;
      }

      #backdrop {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10;
      }

      #modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 1em;
        z-index: 100;
      }
      button {
        padding: 5px 10px;
        margin: 10px;
      }
      label {
        margin: 10px;
        color: black;
      }
      input {
        margin: 10px;
        padding: 5px;
      }
    </style>

    <title>APIs</title>
  </head>
  <body>
    <div>
      <h1>APIs</h1>
      <a href="" id="showForm" class="api">Create API key</a>
      <table>
        <caption>
          Your API(s):
        </caption>
        <tr>
          <th>API Name</th>
          <th>Key</th>
          <th>Created At</th>
        </tr>
        <% apis.forEach(api => { %>
        <tr>
          <td><%= api.apiName %></td>
          <td>
            <a href="" data-api-key="<%= api.apiKey %>"
              ><%= api.apiKey.substring(0,15)+ '....' %></a
            >
          </td>
          <td><%= api.createdAt %></td>
        </tr>
        <% }); %>
      </table>
      <a href="/api/user" class="dashboard">Dashboard</a>
      <a href="/api/user/logout" class="logout">Logout</a>
    </div>

    <div id="backdrop" class="hidden"></div>

    <div id="modal" class="hidden">
      <form method="post" action="/api/user/tokens">
        <label for="apiName">API Name:</label>
        <input type="text" id="apiName" name="apiName" />
        <button type="submit">Create</button>
      </form>
      <button type="button" id="cancel">Cancel</button>
    </div>

    <!-- want to guide the user after creating api key  -->
    <p>
      Use
      <a
        href=""
        data-api-key="http://localhost:3000/api/your-api-key?category=your-category"
        >http://localhost:3000/api/your-api-key?category=your-category</a
      >
      to access your coupons
    </p>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const showForm = document.getElementById("showForm");
        const modal = document.getElementById("modal");
        const backdrop = document.getElementById("backdrop");
        const cancel = document.getElementById("cancel");

        showForm.addEventListener("click", (event) => {
          event.preventDefault(); // Prevent the link from navigating to a new page
          modal.classList.remove("hidden"); // Show the modal
          backdrop.classList.remove("hidden"); // Show the backdrop
        });

        cancel.addEventListener("click", () => {
          modal.classList.add("hidden"); // Hide the modal
          backdrop.classList.add("hidden"); // Hide the backdrop
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        const apiLinks = document.querySelectorAll("a[data-api-key]");

        apiLinks.forEach((link) => {
          link.addEventListener("click", (event) => {
            event.preventDefault(); // Prevent the link from navigating to a new page

            const apiKey = event.currentTarget.getAttribute("data-api-key");
            navigator.clipboard.writeText(apiKey); // Copy the API key to the clipboard
          });
        });
      });
    </script>
  </body>
</html>
